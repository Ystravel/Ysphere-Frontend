import{p as N,aL as z,aw as D,g as T,D as H,aN as K,b1 as Q,o as X,u as J,aP as O,aQ as S,c as a,H as F,a0 as W,a1 as Y,a2 as Z,x as C,A as ee,X as ae,ao as se,a8 as s,a7 as oe,ae as U,a3 as te,a5 as le,a6 as j,ac as i,a9 as re,V as ne,aC as B,ad as k,K as E,b2 as ie,ab as ce,b3 as ue}from"./index-BV8bbD0b.js";import{_ as de}from"./logo_horizontal-BK2T4LU0.js";import{c as me,a as M,u as pe,b as A}from"./index.esm-B3psiW6s.js";import{V as fe}from"./VContainer-CLyjovFk.js";import{V as ge}from"./VForm-CBx9rMby.js";import{V as L,a as l}from"./VRow-C5j3FJZp.js";import{m as ve,V as R}from"./VCheckboxBtn-B-5oFklM.js";import{V as $}from"./VDivider-BX56lJa1.js";import"./_commonjsHelpers-Cpj98o6Y.js";const be=N({...z(),...D(ve(),["inline"])},"VCheckbox"),ke=T()({name:"VCheckbox",inheritAttrs:!1,props:be(),emits:{"update:modelValue":r=>!0,"update:focused":r=>!0},setup(r,u){let{attrs:g,slots:t}=u;const c=H(r,"modelValue"),{isFocused:d,focus:m,blur:V}=K(r),x=Q(),b=X(()=>r.id||`checkbox-${x}`);return J(()=>{const[p,v]=O(g),y=S.filterProps(r),h=R.filterProps(r);return a(S,F({class:["v-checkbox",r.class]},p,y,{modelValue:c.value,"onUpdate:modelValue":o=>c.value=o,id:b.value,focused:d.value,style:r.style}),{...t,default:o=>{let{id:e,messagesId:f,isDisabled:n,isReadonly:w,isValid:P}=o;return a(R,F(h,{id:e.value,"aria-describedby":f.value,disabled:n.value,readonly:w.value},v,{error:P.value===!1,modelValue:c.value,"onUpdate:modelValue":_=>c.value=_,onFocus:m,onBlur:V}),t)}})}),{}}}),q={},Ve={key:0,id:"background",class:"d-flex justify-center align-center"},xe="890205288379-2bm447qt1rj7jkooc7luqej83if9inp4.apps.googleusercontent.com",G={__name:"login",setup(r){const u=te(),g=Y(),t=Z(),c=C(!0),d=C(!1),m=C(!1),V=me({email:M().required("請輸入email").email("請輸入正確email格式"),password:M().required("請輸入密碼")}),{handleSubmit:x,isSubmitting:b}=pe({validationSchema:V}),p=A("email"),v=A("password"),y=async o=>{try{if(!o.code)throw new Error("未收到 Google 授權碼");const e=await g.googleLogin(o.code);e==="登入成功"?(t({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),u.push("/profile")):t({text:e,snackbarProps:{color:"red-lighten-1"}})}catch(e){console.error("Google 登入錯誤:",e),e.response&&e.response.data&&e.response.data.message==="您是初次登入，請使用初始密碼登入"?t({text:"您是初次登入，請使用初始密碼登入",snackbarProps:{color:"red-lighten-1"}}):t({text:"Google 登入失敗，請稍後再試",snackbarProps:{color:"red-lighten-1"}})}},h=x(async o=>{m.value?localStorage.setItem("savedEmail",o.email):localStorage.removeItem("savedEmail");const e=await g.login(o);e==="登入成功"?(t({text:e,snackbarProps:{color:"teal-lighten-1"}}),u.push("/profile")):e==="首次登入,請修改密碼"?u.push("/first-time-login"):t({text:e,snackbarProps:{color:"red-lighten-1"}})});return ee(async()=>{const o=localStorage.getItem("savedEmail");o&&(p.value.value=o,m.value=!0);const e=new URLSearchParams(window.location.search),f=e.get("token"),n=e.get("email"),w=e.get("avatar"),P=e.get("name"),_=parseInt(e.get("role"),10),I=e.get("message");if(I){t({text:I,snackbarProps:{color:"red-lighten-1"}}),c.value=!1;return}f&&(g.$patch({token:f,email:n,avatar:w,name:P,role:_}),await ae(),t({text:"登入成功",snackbarProps:{color:"teal-lighten-1"}}),u.push("/")),c.value=!1}),(o,e)=>{const f=le("router-link");return c.value?U("",!0):(j(),se("div",Ve,[a(fe,{width:"380",height:"510",class:"login-wrapper mx-2 mx-sm-0"},{default:s(()=>[a(ge,{disabled:i(b),onSubmit:re(i(h),["prevent"])},{default:s(()=>[a(L,{class:"px-4"},{default:s(()=>[a(l,{cols:"12",class:"pt-9 pb-6 pe-8 d-flex justify-center"},{default:s(()=>[a(ne,{src:de,"max-width":"200"})]),_:1}),a(l,{cols:"12"},{default:s(()=>[a(B,{modelValue:i(p).value.value,"onUpdate:modelValue":e[0]||(e[0]=n=>i(p).value.value=n),"error-messages":i(p).errorMessage.value,label:"email",density:"compact",variant:"underlined",clearable:""},null,8,["modelValue","error-messages"])]),_:1}),a(l,{cols:"12",class:"pb-1"},{default:s(()=>[a(B,{modelValue:i(v).value.value,"onUpdate:modelValue":e[1]||(e[1]=n=>i(v).value.value=n),"error-messages":i(v).errorMessage.value,type:d.value?"text":"password","append-inner-icon":d.value?"mdi-eye-off":"mdi-eye",label:"password",density:"compact",variant:"underlined","onClick:appendInner":e[2]||(e[2]=n=>d.value=!d.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),a(l,{cols:"12",class:"ps-2 pe-4 py-0 d-flex justify-space-between align-center"},{default:s(()=>[a(ke,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),label:"記住我","hide-details":"",density:"compact",color:"grey-darken-2",class:"text-caption"},null,8,["modelValue"]),a(f,{class:"text-caption text-blue-grey-darken-2",to:"./forgotPassword"},{default:s(()=>e[4]||(e[4]=[k(" 忘記密碼？ ")])),_:1})]),_:1}),a(l,{cols:"12",class:"text-center"},{default:s(()=>[a(E,{block:"",elevation:"2",color:"blue-grey-darken-2",type:"submit",loading:i(b)},{default:s(()=>e[5]||(e[5]=[k(" Login ")])),_:1},8,["loading"])]),_:1}),a(l,{cols:"12",class:"py-0 ps-2"}),a(l,null,{default:s(()=>[a(L,null,{default:s(()=>[a(l,{cols:"5"},{default:s(()=>[a($,{class:"my-4"})]),_:1}),a(l,{cols:"2",class:"d-flex align-center justify-center pa-0",style:{"letter-spacing":"2px","font-size":"15px",opacity:"60%"}},{default:s(()=>e[6]||(e[6]=[k(" 或使用 ")])),_:1}),a(l,{cols:"5"},{default:s(()=>[a($,{class:"my-4"})]),_:1})]),_:1})]),_:1}),a(l,{cols:"12",class:"text-center"},{default:s(()=>[a(i(ie),{callback:y,"client-id":xe,prompt:"",class:"w-100"},{default:s(()=>[a(E,{block:"",elevation:"2",color:"cyan-darken-3"},{default:s(()=>[a(ce,{icon:"mdi-google-plus",size:"24",class:"me-2"}),e[7]||(e[7]=k("Google 登入 "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1}),c.value?(j(),oe(ue,{key:0,indeterminate:"",size:"64",color:"primary",class:"center-screen"})):U("",!0)]))}}};typeof q=="function"&&q(G);const Ue=W(G,[["__scopeId","data-v-f9e92e40"]]);export{Ue as default};
